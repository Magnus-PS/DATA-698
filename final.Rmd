---
title: 'DATA 698 Final Research Project'
author: "Magnus Skonberg"
date: "`r Sys.Date()`" # Due 5/11/2021
output:
  html_document:
    toc: yes
    toc_float: yes
    number_sections: no
    theme: flatly
    highlight: tango
  pdf_document:
    latex_engine: xelatex
    toc: yes
---

```{=html}
<style type="text/css">

code {
  font-family: "Consolas";
  font-size: 11px;
}

pre {
  font-family: "Consolas";
  font-size: 11px;
}

</style>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, eval = T) 
knitr::opts_chunk$set(fig.width=12, fig.height=8)

library(tidyverse)
library(dplyr)
library(readr)
library(ggplot2)
library(RCurl)
library(rvest)
library(stringr)
library(tidyr)
library(kableExtra)
library(BBmisc)
library(tm)
library(sqldf)
library(inspectdf)
library(corrplot)
library(MASS)

options(scipen = 9)
set.seed(123)
```

## Abstract

TBD

## Introduction

### Author

### The Problem

## Literature Review

To be amended ...

## Methodology

* Data Gathering & Pre-Processing
* Data Exploration & Preparation
* Multivariate Regression Analysis

## Experimentation & Results


### Data Exploration & Preparation

```{r}

#baseline EDA: glimpse() and summary()
# glimpse(df)
# summary(df)

```

From the above output we see that we're dealing with 2 categorical variables, 23 numeric variables, and a significant NA count for numerous variables. We'll deal with NA values later and define our variables as:

* `State`: State identifier.
* `County`: County identifier.
* `health_score`: quantitative, dependent variable that provides a measure of 'healthy lifestyle' as a function of longevity, obesity, and physical activity.
* `Hvy`: quantitative, independent variable representative of percent of population that drink heavily (how many drinks)
* `HvyPctChg`
* `Bng`
* `BngPctChg`
* `Mortality`
* `MortalityChg`
* `LTHighSchool`
* `HighSchool`
* `SomeCollege`
* `College`
* `EQI`
* `FoodInsecurity`
* `Sun`
* `Unemployment`
* `UnemploymentChg`
* `Poverty`
* `Income`
* `Population`
* `Births`
* `Deaths`
* `NetMig`
* `PopChg`

The categorical variables are our states and counties and not of much use for anything beyond identification. For this reason, our exploratory data analysis (EDA) focuses on the numeric variables.

As a next step, we explore their numeric distributions:

```{r}

#drop NAs from consideration
# df <- drop_na(df)
# dim(df) #3154 - 3004 = 150 dropped observations
# 
# #skimr, inspectdf - no visible graphic ... 
# #inspectdf::inspect_num(df) %>%
# # show_plot()
# 
# #Histograms for all variables
# df %>%
#     keep(is.numeric) %>%
#     gather() %>% 
#     ggplot(aes(value)) +
#         facet_wrap(~ key, scales = "free", ncol=4) +
#         geom_histogram(bins=90,color="darkblue", fill="lightblue")

```

We're dealed with varied distributions based on the variable:

* **Right skewed**:
* **Left skewed**:
* **Normal**:

We also see that our scales are quite varied, which for generalized linear regression models can present a problem and so normalization will have to be accounted for when we prepare our data.

```{r}

#boxplot vs. target

# names <- df %>% select_if(is.numeric)
# int_names <- names(names)
# 
# for (i in int_names) {
#   assign(paste0("var_",i), ggplot(df, aes_string(x = df$health_score, y = i)) + 
#           geom_boxplot(color = 'steelblue', 
#                        outlier.color = 'firebrick', 
#                        outlier.alpha = 0.35) +
#           #scale_y_continuous(labels = comma) +
#           labs(title = paste0(i,' vs target'), y = i, x= 'target') +
#           theme_minimal() + 
#           theme(
#             plot.title = element_text(hjust = 0.45),
#             panel.grid.major.y =  element_line(color = "grey", linetype = "dashed"),
#             panel.grid.major.x = element_blank(),
#             panel.grid.minor.y = element_blank(),
#             panel.grid.minor.x = element_blank(),
#             axis.ticks.x = element_line(color = "grey"),
#             text = element_text(size=16)
#           ))
# }
# gridExtra::grid.arrange(var_Births, var_Bng, var_BngPctChg, var_College, var_Deaths, var_EQI, var_FoodInsecurity, var_HighSchool, var_Hvy, var_HvyPctChg, var_Income, var_LTHighSchool, var_Mortality, var_MortalityChg, var_NetMig, var_PopChg, var_Population, var_Poverty, var_SomeCollege, var_Sun, var_Unemployment, var_UnemploymentChg, nrow=4)

```

Interpretation and transition ...

```{r}

#pairs plot and correlation matrix
# ##Pairs plot
# pairs(df %>% select_if(is.numeric))
# 
# ##Correlation matrix
# numeric_values <- df %>% select_if(is.numeric)
# df_cor <- cor(numeric_values)
# corrplot.mixed(df_cor, tl.col = 'black', tl.pos = 'lt')

```

LEFT OFF HERE

```{r}

#address NAs - DONE

#multicollinearity

#outliers

#normalization
```

### Multivariate Regression Analysis

```{r}

#Baseline model (model 1)
# df_base <- subset(df, select=-c(1,2)) #categorical columns
# model_1 <- lm(health_score ~., data = df_base)
# summary(model_1) #R^2 = 0.6725, vars = 23
# 
# #AIC optimized model (model 2)
# stepAIC(model_1)
# model_2 <- lm(formula = health_score ~ Hvy + HvyPctChg + Bng + BngPctChg + 
#     Mortality + HighSchool + SomeCollege + College + EQI + FoodInsecurity + 
#     Sun + Unemployment + UnemploymentChg + Poverty + Population + 
#     Births + Deaths + NetMig, data = df_base)
# summary(model_2) #R^2 = 0.672, vars = 18

```

## Conclusions & Next Steps

What have I learned?

Areas for Future Research

## Bibliography

## Appendix with Code

```{r ref.label=knitr::all_labels(), echo=TRUE, eval=FALSE}

```

How have we done this in the past? (ie. DATA 621)